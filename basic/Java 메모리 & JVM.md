# 메모리 구조

- 모든 자바 프로그램은 자바 가상 머신(JVM)을 통해서 실행됩니다.
- 자바 프로그램이 실행되면, JVM은 운영 체제로부터 해당 프로그램을 수행할 수 있도록 필요한 메모리를 할당받습니다.
- 이렇게 할당받은 메모리를 JVM은 용도에 따라 다음과 같이 구분하여 관리합니다.

![image](https://user-images.githubusercontent.com/74396651/197968889-7fb14e9c-2bc2-4f2f-b8ee-a811beb45443.png)

### 메소드(method) 영역

- 메소드(method) 영역은 자바 프로그램에서 사용되는 클래스에 대한 정보와 함께 클래스 변수(static variable)가 저장되는 영역입니다.
- JVM은 자바 프로그램에서 특정 클래스가 사용되면 해당 클래스의 클래스 파일(*.class)를 읽어들여, 해당 클래스에 대한 정보를 메소드 영역에 저장합니다.

### 힙(heap) 영역

- 힙(heap) 영역은 자바 프로그램에서 사용되는 모든 인스턴스 변수가 저장되는 영역입니다.
- JVM은 자바 프로그램에서 new 키워드를 사용하여 인스턴스가 생성되면, 해당 인스턴스의 정보를 힙 영역에 저장합니다.
- 힙 영역은 메모리의 낮은 주소에서 높은 주소의 방향으로 할당됩니다.

### 스택(stack) 영역

- 스택(stack) 영역은 자바 프로그램에서 메소드가 호출될 때 메소드의 스택 프레임이 저장되는 영역입니다.
- JVM은 자바 프로그램에서 메소드가 호출되면, 메소드의 호출과 관계되는 지역 변수와 매개변수를 스택 영역에 저장합니다.
- 이렇게 스택 영역은 메소드의 호출과 함께 할당되며, 메소드의 호출이 완료되면 소멸합니다.
- 이렇게 스택 영역에 저장되는 메소드의 호출 정보를 스택 프레임(stack frame)이라고 합니다.
- 스택 영역은 푸시(push) 동작으로 데이터를 저장하고, 팝(pop) 동작으로 데이터를 인출합니다.
- 이러한 스택은 후입선출(LIFO, Last-In First-Out) 방식에 따라 동작하므로, 가장 늦게 저장된 데이터가 가장 먼저 인출됩니다.
- 스택 영역은 메모리의 높은 주소에서 낮은 주소의 방향으로 할당됩니다.

---

# JVM(Java Virtual Machine)

### JVM 개념

- 자바 가상 머신 JVM(Java Virtual Machine)은 자바 프로그램 실행환경을 만들어 주는 소프트웨어입니다.
- 자바 코드를 컴파일하여 .class 바이트 코드로 만들면 이 코드가 자바 가상 머신 환경에서 실행됩니다.
- JVM은 자바 실행 환경 JRE(Java Runtime Environment)에 포함되어 있습니다.
- 현재 사용하는 컴퓨터의 운영체제에 맞는 자바 실행환경 (JRE)가 설치되어 있다면 자바 가상 머신이 설치되어 있다는 뜻입니다.

### JVM의 특징

- Java는 컴파일된 바이트 코드로서 어떠한 플랫폼에 영향을 받지 않는다. 하지만 JVM은 플랫폼에 종속적이다.
- 윈도우의 JVM과 리눅스의 JVM이 서로 다르다. 자바로 작성된 모든 프로그램은 JVM에서만 실행될 수 있으므로 반드시 JVM이 설치되어 있어야 한다.
- JVM을 사용하면 하나의 바이트 코드(.class)로 모든 플랫폼에서 동작할 수 있다.

![image](https://user-images.githubusercontent.com/74396651/197968967-b76c7dc9-98ff-4c1a-860a-cdaa58252af9.png)

<hr>

### JVM(Java Virtual Machine) 동작 방식

![image](https://user-images.githubusercontent.com/74396651/197968943-1caae4d4-cacc-4205-9ce2-ed9ec9ee5d28.png)

**1.** 자바로 개발된 프로그램을 실행하면 JVM은 OS로부터 메모리를 할당합니다.

**2.** 자바 컴파일러(javac)가 자바 소스코드(.java)를 자바 바이트코드(.class)로 컴파일합니다.

**3.** Class Loader를 통해 JVM Runtime Data Area로 로딩합니다.

**4.** Runtime Data Area에 로딩 된 .class들은 Execution Engine을 통해 해석합니다.

**5.** 해석된 바이트 코드는 Runtime Data Area의 각 영역에 배치되어 수행하며 이 과정에서 Execution Engine에 의해 GC의 작동과 스레드 동기화가 이루어집니다.
